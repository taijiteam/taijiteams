<!DOCTYPE html>
<html class="x-admin-sm">
  
  <head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.1</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/font.css">
    <link rel="stylesheet" href="__PUBLIC__/Admin/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/xadmin.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/js/cookie.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="x-body">
        <form class="layui-form">
            <div class="layui-form-item">
                <label for="category" class="layui-form-label"><span class="x-red">*</span>会员类别</label>
                <div class="layui-input-inline">
                    <!--<input type="text" id="m_category" name="m_category" required="" lay-verify="nikename"autocomplete="off" class="layui-input">-->
                    <select id="category" name="category" autocomplete="off" class="layui-input">
                        <option value="珠宝首饰">珠宝首饰</option>
                        <option value="工艺礼品">工艺礼品</option>
                        <option value="甄选名酒">甄选名酒</option>
                        <option value="艺术文化">艺术文化</option>
                        <option value="营养保健">营养保健</option>
                        <option value="私人定制">私人定制</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label for="encoding" class="layui-form-label"><span class="x-red">*</span>商品编码</label>
                <div class="layui-input-inline">
                    <input type="text" id="encoding" name="encoding" required="" lay-verify="nikename" autocomplete="off" class="layui-input">
                    *<span class="x-red" style="color: #7d7d7d">类型首字母大写+数字编号</span></div>

            </div>
            <div class="layui-form-item">
                <label for="name" class="layui-form-label"><span class="x-red">*</span>商品名称</label>
                <div class="layui-input-inline">
                    <input type="text" id="name" name="name" required="" lay-verify="nikename"autocomplete="off" class="layui-input">
                </div>
            </div>
             <div class="layui-form-item">
                <label for="photo" class="layui-form-label">商品主图</label>
                <div class="layui-input-inline">
                    <!--<input type="file" id="m_img" name="m_img" autocomplete="off" class="layui-input">-->
                    <button type="button" class="layui-btn" id="test1">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>
                    <div id="photo"></div>
                </div>
            </div>
            <!-- <div class="layui-form-item">
                <label for="photo" class="layui-form-label">照片</label>
                <div class="layui-input-inline">
                    &lt;!&ndash;<input type="file" id="m_img" name="m_img" autocomplete="off" class="layui-input">&ndash;&gt;

                    <button type="button" class="layui-btn" id="test1">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>
                    <div id="photo"></div>
                </div>
            </div>-->
            <div class="layui-form-item">
                <label for="store" class="layui-form-label">商铺名称</label>
                <div class="layui-input-inline">
                    <input type="text" id="store" name="store" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="pleased" class="layui-form-label">商品进货价</label>
                <div class="layui-input-inline">
                    <input type="text" id="pleased" name="pleased" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="price" class="layui-form-label">商品出售价</label>
                <div class="layui-input-inline">
                    <input type="text" id="price" name="price" autocomplete="off" class="layui-input">
                </div>
                <!--<div class="layui-form-mid layui-word-aux"><span class="x-red">*</span>将会成为您唯一的登入名</div>-->
            </div>
            <div class="layui-form-item">
                <label for="jifen" class="layui-form-label">商品积分</label>
                <div class="layui-input-inline">
                    <input type="text" id="jifen" name="jifen" autocomplete="off" class="layui-input">

                *<span class="x-red" style="color: #7d7d7d">不配合积分使用,可以不填写</span></div>
            </div>
            <div class="layui-form-item">
                <label for="unit" class="layui-form-label"><span class="x-red">*</span>商品单位</label>
                <div class="layui-input-inline">
                    <select id="unit" name="unit" autocomplete="off" class="layui-input">
                        <option value="个">个</option>
                        <option value="只">只</option>
                        <option value="件">件</option>
                        <option value="箱">箱</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label for="count" class="layui-form-label">商品库存</label>
                <div class="layui-input-inline">
                    <input type="text" id="count" name="count" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item">
                <label for="state" class="layui-form-label"><span class="x-red">*</span>展示状态</label>
                <div class="layui-input-inline">
                    <select id="state" name="state" autocomplete="off" class="layui-input">
                        <option value="上架">上架</option>
                        <option value="下架">下架</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label for="photo2" class="layui-form-label">商品详情图</label>
                <div class="layui-input-inline">
                    <!--<input type="file" id="m_img" name="m_img" autocomplete="off" class="layui-input">-->
                    <button type="button" class="layui-btn" id="test2">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>
                    <div id="photo2"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">个人介绍</label>
            </div>
            <div class="text">
                <script id="editor" type="text/plain" style="width:90%;height:350px;margin: auto;"></script>
            </div>
            <div class="layui-form-item">
                <label for="L_repass" class="layui-form-label">
                </label>
                <input type="button" class="layui-btn" lay-filter="add" lay-submit="" value="增加">
            </div>
        </form>
    </div>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/ueditor.all.min.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/Admin/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" >
layui.use('upload', function(){
    var upload = layui.upload;
    //执行实例
    var uploadInst = upload.render({
        elem: '#test1' //绑定元素
        ,url: "{:U('Shopping/goodsPhoto')}" //上传接口
        ,done: function(data){
            //上传完毕回调
            layer.msg(''+data.msg+'',function(){
                var html ='';
                html += '<img src="__PUBLIC__/Uploads/Goods/'+data.photo+'" height="200px" />' +
                    '<input type="hidden"id="photo" name="photo" value='+data.photo+'>';
                $('#photo').html(html);
            });
        }
        ,error: function(){
            //请求异常回调
        }
    });
});
layui.use('upload', function(){
    var upload = layui.upload;
    //执行实例
    var uploadInst = upload.render({
        elem: '#test2' //绑定元素
        ,url: "{:U('Shopping/goodsPhoto2')}" //上传接口
        ,done: function(data){
            //上传完毕回调
            layer.msg(''+data.msg+'',function(){
                var html ='';
                html += '<img src="__PUBLIC__/Uploads/Goods/'+data.photo+'" height="200px" />' +
                    '<input type="hidden"id="photo2" name="photo2" value='+data.photo+'>';
                $('#photo2').html(html);
            });
        }
        ,error: function(){
            //请求异常回调
        }
    });
});
//实例化编辑器
//建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
var ue = UE.getEditor('editor');
//提交
layui.use(['form','layer'], function(){
    $ = layui.jquery;
    var form = layui.form,layer = layui.layer;
    //自定义验证规则
    form.verify({
        nikename: function(value){
            if(value.length < 2){
                return '编码格式不正确';
            }
        }

    });

    //监听提交
    form.on('submit(add)', function(data){
        // alert(JSON.stringify(data));
        //发异步，把数据提交给php
        var category  = $("#category option:checked").val();		//商品类别
        //var photo  = $('input[name="photo"]').val();			//照片
        var encoding  = $('input[name="encoding"]').val();		//商品编号
        var name  = $('input[name="name"]').val();			//商品名称
        var photo  = $('input[name="photo"]').val();			//商品主图
        var photo2  = $('input[name="photo2"]').val();			//商品详情图
        var unit  = $("#unit option:checked").val();		//商品单位
        var store  = $('input[name="store"]').val();			//商品店铺
        var count  = $('input[name="count"]').val();		//库存数量
        var price  = $('input[name="price"]').val();	    //商品价格
        var state  = $("#state option:checked").val();		//商品状态
        var jifen  = $('input[name="jifen"]').val();			//商品积分
        var pleased  = $('input[name="pleased"]').val();		//进货价
        //var remark  = $("#remark option:checked").val();		//商品备注
        //var remark = $('#remark').val();		            	//商品备注
        var introduce = [];
            introduce.push(UE.getEditor('editor').getContent());//个人介绍
        //接收
        // alert(JSON.stringify(introduce));
        // return false;
        $.ajax({
            type:"post",
            url:"{:U('Shopping/shopAdd')}",//根据自己项目的需要写请求地址
            data:{
                'category':category,
                'encoding':encoding,
                'img':photo,
                'img2':photo2,
                'name':name,
                'unit':unit,
                'store':store,
                'count':count,
                'price':price,
                'state':state,
                'jifen':jifen,
                'pleased':pleased,
                'remark':introduce,
            },
            dataType:'json',
            success:function(data){
                // alert(JSON.stringify(data));
                if (data.error == 1){
                    layer.confirm('信息添加成功！',function(index){
                        //关闭当前frame
                        x_admin_close();
                        // 可以对父窗口进行刷新
                        x_admin_father_reload();
                    });
                }else{
                    layer.msg('哎呦，运气不好哦，添加失败咯！',function(){});
                }
            },
            error:function(data) {
                console.log(data.msg);
            },
        })
    });
});
</script>
<script>
    var _hmt = _hmt || []; (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>
<script>
layui.use('laydate', function(){
    var laydate = layui.laydate;
    //日期时间选择器
    laydate.render({
        elem: '#time'
        ,type: 'datetime'
    });
    laydate.render({
        elem: '#indate'
        ,type: 'datetime'
    });
    laydate.render({
        elem: '#birthday'
    });
});
</script>
</body>

</html>