<?php if (!defined('THINK_PATH')) exit();?><!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
<link href="/favicon.ico" rel="shortcut icon">
<meta name="viewport" content="target-densitydpi=device-dpi, width=375px, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>渠道Plus - 商城</title>
<meta name="keywords" content="关键词">
<meta name="description" content="描述">
<link rel="stylesheet" href="/Public/Mobile/css/swiper.min.css" />
<link rel="stylesheet" href="/Public/Mobile/css/common.css?v=<?php echo ($versions); ?>" />
<link rel="stylesheet" href="/Public/Mobile/css/style.css?v=<?php echo ($versions); ?>" />
</head>
<body>

<!--  <div class="pb_tp_a">
   <h1>已关闭 </h1>
     <a href="#" class="pbjta"><img src="/Public/Mobile/images/01322.png"></a>
 </div> -->

<div class="jyzttops container-fluid">
    <div class="container">
        <dbo><a href="javascript:history.go(-1);"><img src="/Public/Mobile/images/sss.png"></a></dbo>
        <span><a href="#">渠道PLUS珍品商城</a></span>
        <span class="fr gwcedit">编辑</span>
    </div>
</div>

<!--
<div class="rysplists container-fluid">
    <div class="ry_aa ry_gwc">
        <div class="container">
            <div class="xuanz fl">
                <div class="fl  shad_a checkbox">
                    <label><input type="checkbox" name="购物车" checked="checked"></label>
                </div>
            </div>
            <div class="ovh fl">
                <img src="/Public/Mobile/images/4937.png">
            </div>
            <div class="rynrr fl">
                <div class="rynrr_a mt0">
                    <span>如意算盘</span>
                    <div class="gwca">
                        <div class="gwcma">
                            <ul class="btn-numbox fl">
                                <li>
                                    <ul class="count">
                                        <li><span class="num-jian2">-</span></li>
                                        <li><input type="text" class="input-num2" id="input-num" value="0"></li>
                                        <li><span  class="num-jia2">+</span></li>
                                    </ul>
                                </li>
                            </ul>
                            <div class="gw_del">
                                <img src="/Public/Mobile/images/222952.png">
                            </div>
                        </div>
                        <div  class="gwcmb">
                            <span>小计<img src="/Public/Mobile/images/rs1.png">798.00</span>
                        </div>
                    </div>
                </div>
                <div class="rynrr_b"  >
                    <div class="ys_nr_b  mt10">
                        <span><img src="/Public/Mobile/images/rs1.png"></span>
                        <span class="ice_b">399.00</span>
                    </div>
                    <p>
                        稀世珍木，代代相传
                        吉光凤羽 祥瑞安康 如心遂愿 意气飞昂
                    </p>
                </div>
            </div>
        </div>
    </div>

</div>
-->
<div id="cart-list" style="    margin-bottom: 120px;">

</div>


<!--为你推荐 -->
<!--
<div class="foryou container-fluid">
    <div class="tit  tc">
        <span><img src="/Public/Mobile/images/Rectangle3.png">为你推荐<img src="/Public/Mobile/images/Rectangle3.png"></span>
    </div>

</div>

<div class="cnxh cnxh_b container-fluid">
    <div class="allpro container">
        <ul>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
            <li>
                <div class="ovh">
                    <a  href="#">
                        <img src="/Public/Mobile/images/43.png">
                    </a>
                </div>
                <div class="pr_text">
                    <h1>如意算盘</h1>
                    <p>稀世珍木/代代相传</p>
                    <div  class="pr_txt_a">
                        <div class="pr_ice fl">
                            <span><img src="/Public/Mobile/images/rw.png"></span>
                            <span class="ice_b">399.00</span>
                            <span class="ice_c">元</span>
                        </div>
                        <div class="pr_gwc fr">
                            <a href="#"><img src="/Public/Mobile/images/gwc.png"></a>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</div>

-->

<!--全选-->
<div class="qxgwc container-fluid" style="position: fixed;
    bottom: 12px;" id="fix-bottom-order">
    <div  class="container">
        <!--<div  class="qxgw_a fl">-->
            <!--<div class="fl  shad_a checkbox">-->
                <!--<label><input type="checkbox" name="购物车"  checked="checked">全选</label>-->
            <!--</div>-->
        <!--</div>-->
        <div class="qxgw_b fr">
            <div class="gghj fl">
                <p>合计<span id="total-price">¥0.00</span></p>
                <!--<small><span>活动优惠¥32.00</span></small>-->
            </div>
            <div class="gghs fl">
                <input type="button" value="结算" id="order-confirm-btn">
            </div>
        </div>
    </div>
</div>
<div class="qxgwc container-fluid" style="position: fixed;
    bottom: 12px;display: none;" id="fix-bottom-delete">
    <div  class="container">
        <div class="qxgw_b fr">
            <div class="gghj fl">
            </div>
            <div class="gghs fl">
                <input type="button" value="删除" id="cart-del-btn">
            </div>
        </div>
    </div>
</div>
<!--占位元素通用-->


<!-- 导航栏 -->
<div class="container-fluid foots" style="padding-top: 4px;padding-bottom: 10px;height: 100px;bottom: -51px;">
    <ul>
        <?php if(Cart == 'Home'): ?><li class="active"> <?php else: ?> <li><?php endif; ?>
            <a href="/Mobile/Index/home">
					<span>
						<img class="foimg_a" src="/Public/Mobile/images/nav_icon/home_2.png">
						<img class="foimg_b" src="/Public/Mobile/images/nav_icon/home_1.png">
					</span>
                <p>首页</p>
            </a>
        </li>
        <?php if(Cart == 'Category'): ?><li class="active"> <?php else: ?> <li><?php endif; ?>
            <a href="/Mobile/Index/category">
					<span>
						<img class="foimg_a" src="/Public/Mobile/images/nav_icon/category_2.png">
						<img class="foimg_b" src="/Public/Mobile/images/nav_icon/category_1.png">
					</span>
                <p>分类</p>
            </a>
        </li>
        <?php if(Cart == 'Cart'): ?><li class="active"> <?php else: ?> <li><?php endif; ?>
            <a href="/Mobile/Cart/index">
					<span>
						<img class="foimg_a" src="/Public/Mobile/images/nav_icon/cart_2.png">
						<img class="foimg_b" src="/Public/Mobile/images/nav_icon/cart_1.png">
					</span>
                <p>购物车</p>
            </a>
        </li>
        <?php if(Cart == 'Member'): ?><li class="active"> <?php else: ?> <li><?php endif; ?>
            <a href="/Mobile/Member/index">
					<span>
                        <img class="foimg_b" src="/Public/Mobile/images/nav_icon/member_1.png">
						<img class="foimg_a" src="/Public/Mobile/images/nav_icon/member_2.png">
					</span>
                <p>我的</p>
            </a>
        </li>
    </ul>
</div>

<script src="/Public/Mobile/js/jquery-1.11.0.min.js"></script>
<script src="/Public/Mobile/js/swiper.min.js"></script>
<script src="/Public/Mobile/js/jquery.SuperSlide.2.1.3.js"></script>
<script src="/Public/Mobile/js/all.js?v=<?php echo ($versions); ?>"></script>
</body>
</html>

<script>
    $(function(){
        var cart_mode = 1;//1:结算   2:删除

        init();

        function init()
        {
            $.ajax({
                type:"get",
                url:"/Mobile/cart/getUserCart",
                dataType:'json',
                success:function(res)
                {
                    console.log(res);
                    if (res.code == 200){
                        if(res.data.length > 0 ) {
                            var cart_list = '';
                            for(i=0;i<res.data.length;i++)
                            {
                                cart_list = cart_list + '<div class="rysplists container-fluid" id="radio-box-'+res.data[i].goods_id+'" style="padding: 24px 0px;">\n' +
                                    '    <div class="ry_aa ry_gwc">\n' +
                                    '        <div class="container">\n' +
                                    '            <div class="xuanz fl">\n' +
                                    '                <div class="fl  shad_a checkbox">\n' +
                                    '                    <label><input type="radio" id="input-radtio-'+res.data[i].goods_id+'" data-goods-id="'+res.data[i].goods_id+'" name="购物车" ></label>\n' +
                                    '                </div>\n' +
                                    '            </div>\n' +
                                    '            <div class="ovh fl">\n' +
                                    '                <a href="/Mobile/Goods/detail?gc_id='+res.data[i].goods_common_id+'">' +
                                    '                <img src="'+res.data[i].main_img+'" style="width: 105px;height: 70px;margin-left:18px;">\n' +
                                    '                </a>' +
                                    '            </div>\n' +
                                    '            <div class="rynrr fl">\n' +
                                    '                <div class="rynrr_a mt0">\n' +
                                    '                    <span>'+ res.data[i].goods_name +'</span>\n' +
                                    '                    <div class="gwca">\n' +
                                    '                        <div class="gwcma">\n' +
                                    '                            <ul class="btn-numbox fr">\n' +
                                    '                                <li>\n' +
                                    '                                    <ul class="count">\n' +
                                    '                                        <li class="jian"><span class="num-jian2 cart-cut-btn" data-goods-id="'+res.data[i].goods_id+'">-</span></li>\n' +
                                    '                                        <li class="ctprice"><input type="number" class="input-num2" data-goods-id="'+res.data[i].goods_id+'"  id="input-num-'+res.data[i].goods_id+'" value="'+res.data[i].num+'"></li>\n' +
                                    '                                        <li class="jia"><span  class="num-jia2 cart-add-btn" data-goods-id="'+res.data[i].goods_id+'">+</span></li>\n' +
                                    '                                    </ul>\n' +
                                    '                                </li>\n' +
                                    '                            </ul>\n' +
                                    '                        </div>\n' +
                                    '                        <div  class="gwcmb">\n' +
                                    '                            <span>小计<img src="/Public/Mobile/images/rs1.png">' +
                                    '                               <span id="goods-price-'+res.data[i].goods_id+'" data-goods-single-price="'+res.data[i].goods_price+'">'+ parseInt(res.data[i].goods_price * res.data[i].num) + '.00</span>' +
                                    '                            </span>\n' +
                                    '                        </div>\n' +
                                    '                    </div>\n' +
                                    '                </div>\n' +
                                    '                <div class="rynrr_b"  >\n' +
                                    '                    <div class="ys_nr_b  mt10">\n' +
                                    '                        <span><img src="/Public/Mobile/images/rs1.png"></span>\n' +
                                    '                        <span class="ice_b">' + res.data[i].goods_price +'.00</span>\n' +
                                    '                    </div>\n' +
                                    '                    <p>' + res.data[i].goods_remark +'</p>' +
                                    '                </div>\n' +
                                    '            </div>\n' +
                                    '        </div>\n' +
                                    '    </div>\n' +
                                    '\n' +
                                    '</div>';
                            }
                            $('#cart-list').append(cart_list);
                        } else {
                            var empty_cart = "    <span style=\"position: relative;\n" +
                                "    left: 127px;\n" +
                                "    top: 200px;\n" +
                                "    color: #7c7c7c;\">购物车里 空空如也</span>";
                            $('#cart-list').html(empty_cart);
                        }
                    }
                },
                error:function(data) {
                    console.log(data.msg);
                },
            })
        }


        $(document).on('click','.cart-add-btn',function(){
            var goods_id = $(this).attr('data-goods-id');

            $.ajax({
                type: "get",
                url: "/Mobile/cart/addOne",
                data:{
                    goods_id:goods_id
                },
                dataType: 'json',
                success: function (res) {
                    if(res.code == '200'){
                        var n = $('#input-num-'+goods_id).val();
                        n = parseInt(n) + 1;
                        $('#input-num-'+goods_id).val(n);

                        var single_price = $("#goods-price-"+goods_id);
                        var price = single_price.attr('data-goods-single-price') * n;
                        console.log(price);
                        single_price.text(parseInt(price)+'.00');

                        var is_checked = $("#input-radtio-"+goods_id).is(":checked");
                        if(is_checked){
                            $("#total-price").text("¥"+parseInt(price)+'.00');
                        }
                    } else {
                        alert(res.message);
                    }
                }
            })
        });


        $(document).on('click','.cart-cut-btn',function(){
            var goods_id = $(this).attr('data-goods-id');

            $.ajax({
                type: "get",
                url: "/Mobile/cart/cutOne",
                data:{
                    goods_id:goods_id
                },
                dataType: 'json',
                success: function (res) {
                    if(res.code == '200'){
                        var n = $('#input-num-'+goods_id).val();
                        if(n == 1){
                            $('#radio-box-'+goods_id).remove();
                        }else{
                            n = parseInt(n) - 1;
                            $('#input-num-'+goods_id).val(n);

                            var single_price = $("#goods-price-"+goods_id);
                            var price = single_price.attr('data-goods-single-price') * n;
                            console.log(price);
                            single_price.text(parseInt(price)+'.00');

                            var is_checked = $("#input-radtio-"+goods_id).is(":checked");
                            if(is_checked){
                                $("#total-price").text("¥"+parseInt(price)+'.00');
                            }
                        }
                    } else {
                        alert(res.message);
                    }
                }
            })
        });


        $(document).on('click','#cart-del-btn',function(){
            var radio = $('input[type="radio"]:checked');
            if( radio.length != 1) {
                return false;
            }

            var goods_id = parseInt(radio.attr("data-goods-id"));
            if(goods_id <= 0){
                alert("请选择要删除的商品");
                return false;
            }

            $.ajax({
                type: "get",
                url: "/Mobile/cart/clean",
                data:{
                    goods_id:goods_id
                },
                dataType: 'json',
                success: function (res) {
                    if(res.code == '200'){
                        var is_checked = $("#input-radtio-"+goods_id).is(":checked");
                        $('#radio-box-'+goods_id).remove();
                        if(is_checked){
                            $("#total-price").text("¥0.00");
                        }

                        var empty_cart = parseInt($("#cart-list").html());
                        if(!empty_cart)
                        {
                            empty_cart = "    <span style=\"position: relative;\n" +
                                "    left: 127px;\n" +
                                "    top: 200px;\n" +
                                "    color: #7c7c7c;\">购物车里 空空如也</span>";
                            $('#cart-list').html(empty_cart);
                        }
                    } else {
                        alert(res.message);
                    }
                }
            })
        });


        $(document).on('keyup','input[type="number"]',function () {
            var num = $(this).val();
            num = parseInt((num=num.replace(/D/g,''))==''||parseInt((num=num.replace(/D/g,''))==0)?'1':num,10);
            $(this).val(num);

            var goods_id = $(this).attr("data-goods-id");
            var single_price = $("#goods-price-"+goods_id);
            var price = single_price.attr('data-goods-single-price') * num;
            console.log(price);
            single_price.text(parseInt(price)+'.00');

            var is_checked = $("#input-radtio-"+goods_id).is(":checked");
            if(is_checked){
                $("#total-price").text("¥"+parseInt(price)+'.00');
            }
        });

        $(document).on('click','input[type="radio"]:checked',function(){
            var goods_id = $(this).attr("data-goods-id");
            var price = $("#goods-price-"+goods_id).text();
            console.log(price);
            if(!price) price = 0;
            $("#total-price").text("¥"+parseInt(price)+'.00');
        });

        $(document).on('click','#order-confirm-btn',function(){
            var goods_id = $('input[type="radio"]:checked').attr('data-goods-id');
            var num      = $('#input-num-'+goods_id).val();
            if(goods_id > 0 && num > 0){
                window.location.href = "/Mobile/Order/order_confirm?goods_id="+goods_id+"&num="+num;
            }
        });

        $(document).on('click','.gwcedit',function(){
            if(cart_mode == 1){
                cart_mode = 2;
                $(this).text("完成");
                $("#fix-bottom-order").hide();
                $("#fix-bottom-delete").show();
            }else{
                cart_mode = 1;
                $(this).text("编辑");
                $("#fix-bottom-delete").hide();
                $("#fix-bottom-order").show();

                var radio = $('input[type="radio"]:checked');
                var goods_id = radio.attr("data-goods-id");
                var price = $("#goods-price-"+goods_id).text();
                if(!price) price = 0;
                $("#total-price").text("¥"+parseInt(price)+'.00');
            }
        });

    });
</script>